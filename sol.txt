console.log("main process");

const electron = require("electron");
const path = require("path");
const url = require("url");
const app = electron.app;
const ipc = electron.ipcMain;
const dialog = electron.dialog;
const Menu = electron.Menu;
const MenuItem = electron.MenuItem;
const globalShortcut = electron.globalShortcut;
const BrowserWindow = electron.BrowserWindow;

let win;
function createWindow() {
  win = new BrowserWindow({
    width: 800,
    height: 600,
    webPreferences: { nodeIntegration: true, contextIsolation: false },
  });

  win.loadURL(
    url.format({
      pathname: path.join(__dirname, "index.html"),
      protocol: "file",
      slashes: true,
    })
  );

  win.webContents.openDevTools();

  win.on("closed", () => {
    win = null;
  });
}

ipc.on("open-error-dialog", function (event) {
  dialog.showErrorBox("Ann error message", "Demo of error app");
  event.sender.send("open-error-dialog", "Main Process finised request");
});
app.on("ready", createWindow);

const template = [
  {
    label: "Edit",
    submenu: [
      { role: "undo" },
      { role: "redo" },
      { role: "separator" },
      { role: "cut" },
      { role: "paste" },
      { role: "delete" },
      { role: "deleteall" },
    ],
  },
  {
    label: "Demo",
    submenu: [
      {
        label: "SubMenu",
        click: function () {
          console.log("clicked sub menu 1");
        },
      },
      {
        type: "seprator",
      },
      {
        label: "submenu2",
      },
    ],
  },
];

app.on("window-all-closed", () => {
  if (process.platform !== "darwin") {
    app.quit();
  }
});

const menu= Menu.buildFromTemplate(template)
Menu.setApplicationMenu(menu)
app.on("activate", () => {
  if (win == null) {
    createWindow();
  }
});
